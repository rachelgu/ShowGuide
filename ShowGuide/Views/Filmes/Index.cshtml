@model IEnumerable<ShowGuide.Models.Filme>

@{
    ViewBag.Title = "Filmes";
}
<h2>@ViewBag.Title</h2>
@* Caixa de pesquisa*@
<div class="card">
    <div class="card-body">
        @using (Html.BeginForm("Index", "Filmes", FormMethod.Get, new { @class = "row" }))
        {
            @* Botão de registo de filmes para o administrador *@
            if (User.IsInRole("Admin"))
            {
                <div class="col-lg-2 mt-2 mb-2">
                    @Html.ActionLink("Registar", "Create", new { }, new { @class = "btn btn-primary col-12" })
                </div>
            }
            <div class="form-group col-lg mt-2 mb-2">
                <input type="search" name="search" class="form-control col-12" value="@ViewBag.search" />
            </div>
            <div class="col-lg-2  mt-2 mb-2">
                <button type="submit" class="btn btn-success col-12">Pesquisar</button>
            </div>

            @* Filtro de filmes vistos ou não visatos caso o utilizador esteja autenticado*@
            if (Request.IsAuthenticated)
            {
                <div class="col-12 text-center">
                    <div class="card">
                        <div class="form-group mb-1 mt-1">
                            <div class="form-check d-md-inline">
                                <label class="form-check-label">
                                    @Html.RadioButton("filtroVistos", -1, (int)ViewBag.filtroVistos == -1)Todos
                                </label>
                            </div>
                            <div class="form-check d-md-inline">
                                <label class="form-check-label">
                                    @Html.RadioButton("filtroVistos", 0, (int)ViewBag.filtroVistos == 0)Só os vistos
                                </label>
                            </div>
                            <div class="form-check d-md-inline">
                                <label class="form-check-label">
                                    @Html.RadioButton("filtroVistos", 1, (int)ViewBag.filtroVistos == 1)Só os não vistos
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>
@* Lista de filmes*@
<section class="row title-sizes mt-4">
    @foreach (var filme in Model)
    {
    <figure class="col-md-3 col-sm-6  pretty-figure">
        <a href="@Url.Action("Details","Filmes",new { id = filme.Id})">
            <img src="~/Imagens/@Html.DisplayFor(modelItem => filme.Id)@Html.DisplayFor(modelItem => filme.ImageExtension)" alt="Prospect (2018)"
                 class="img-responsive">
        </a>
        <figcaption class="no-rating">
            <a href="@Url.Action("Details","Filmes",new { id = filme.Id})">@Html.DisplayFor(modelItem => filme.Titulo)</a>
        </figcaption>

        @* Checkbox que indica se o utilizador viu ou não o filme *@
        @if (Request.IsAuthenticated)
        {
            <figcaption class="no-rating">
                @using (Html.BeginForm("ToggleViewed", "Filmes", FormMethod.Post))
                {
                    @Html.AntiForgeryToken();
                    @Html.HiddenFor(f => filme.Id);
                    @Html.Hidden("search", (string)ViewBag.search);
                    @Html.Hidden("filtroVistos", (int)ViewBag.filtroVistos);
                    <label class="form-check-label">
                        @Html.CheckBox("viewed", filme.Utilizadores.Any(u => u.UserName.Equals(User.Identity.Name)), new { onchange = "this.form.submit()" })
                        Visto?
                    </label>
                }
            </figcaption>
        }
    </figure>

    }

    @* Caso não exista filmes*@
    @if (Model.Count() == 0)
    {
        <div style="text-align: center;" class="w-100 mt-2">
            <h5>Não foram encontrados Filmes.</h5>
        </div>
    }
</section>